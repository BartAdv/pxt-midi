enum MidiInstrument {
    //% block="Acoustic Grand Piano" enumval=1 blockIdentity="midi.instrument"
    AcousticGrandPiano = 1,
    //% block="Bright Acoustic Piano" enumval=2 blockIdentity="midi.instrument"
    BrightAcousticPiano = 2,
    //% block="Electric Grand Piano" enumval=3 blockIdentity="midi.instrument"
    ElectricGrandPiano = 3,
    //% block="Honky-tonk Piano" enumval=4 blockIdentity="midi.instrument"
    HonkytonkPiano = 4,
    //% block="Electric Piano 1" enumval=5 blockIdentity="midi.instrument"
    ElectricPiano1 = 5,
    //% block="Electric Piano 2" enumval=6 blockIdentity="midi.instrument"
    ElectricPiano2 = 6,
    //% block="Harpsichord" enumval=7 blockIdentity="midi.instrument"
    Harpsichord = 7,
    //% block="Clavi" enumval=8 blockIdentity="midi.instrument"
    Clavi = 8,
    //% block="Celesta" enumval=9 blockIdentity="midi.instrument"
    Celesta = 9,
    //% block="Glockenspiel" enumval=10 blockIdentity="midi.instrument"
    Glockenspiel = 10,
    //% block="Music Box" enumval=11 blockIdentity="midi.instrument"
    MusicBox = 11,
    //% block="Vibraphone" enumval=12 blockIdentity="midi.instrument"
    Vibraphone = 12,
    //% block="Marimba" enumval=13 blockIdentity="midi.instrument"
    Marimba = 13,
    //% block="Xylophone" enumval=14 blockIdentity="midi.instrument"
    Xylophone = 14,
    //% block="Tubular Bells" enumval=15 blockIdentity="midi.instrument"
    TubularBells = 15,
    //% block="Dulcimer" enumval=16 blockIdentity="midi.instrument"
    Dulcimer = 16,
    //% block="Drawbar Organ" enumval=17 blockIdentity="midi.instrument"
    DrawbarOrgan = 17,
    //% block="Percussive Organ" enumval=18 blockIdentity="midi.instrument"
    PercussiveOrgan = 18,
    //% block="Rock Organ" enumval=19 blockIdentity="midi.instrument"
    RockOrgan = 19,
    //% block="Church Organ" enumval=20 blockIdentity="midi.instrument"
    ChurchOrgan = 20,
    //% block="Reed Organ" enumval=21 blockIdentity="midi.instrument"
    ReedOrgan = 21,
    //% block="Accordion" enumval=22 blockIdentity="midi.instrument"
    Accordion = 22,
    //% block="Harmonica" enumval=23 blockIdentity="midi.instrument"
    Harmonica = 23,
    //% block="Tango Accordion" enumval=24 blockIdentity="midi.instrument"
    TangoAccordion = 24,
    //% block="Acoustic Guitar (nylon)" enumval=25 blockIdentity="midi.instrument"
    AcousticGuitarNylon = 25,
    //% block="Acoustic Guitar (steel)" enumval=26 blockIdentity="midi.instrument"
    AcousticGuitarSteel = 26,
    //% block="Electric Guitar (jazz)" enumval=27 blockIdentity="midi.instrument"
    ElectricGuitarJazz = 27,
    //% block="Electric Guitar (clean)" enumval=28 blockIdentity="midi.instrument"
    ElectricGuitarClean = 28,
    //% block="Electric Guitar (muted)" enumval=29 blockIdentity="midi.instrument"
    ElectricGuitarMuted = 29,
    //% block="Overdriven Guitar" enumval=30 blockIdentity="midi.instrument"
    OverdrivenGuitar = 30,
    //% block="Distortion Guitar" enumval=31 blockIdentity="midi.instrument"
    DistortionGuitar = 31,
    //% block="Guitar harmonics" enumval=32 blockIdentity="midi.instrument"
    GuitarHarmonics = 32,
    //% block="Acoustic Bass" enumval=33 blockIdentity="midi.instrument"
    AcousticBass = 33,
    //% block="Electric Bass (finger)" enumval=34 blockIdentity="midi.instrument"
    ElectricBassFinger = 34,
    //% block="Electric Bass (pick)" enumval=35 blockIdentity="midi.instrument"
    ElectricBassPick = 35,
    //% block="Fretless Bass" enumval=36 blockIdentity="midi.instrument"
    FretlessBass = 36,
    //% block="Slap Bass 1" enumval=37 blockIdentity="midi.instrument"
    SlapBass1 = 37,
    //% block="Slap Bass 2" enumval=38 blockIdentity="midi.instrument"
    SlapBass2 = 38,
    //% block="Synth Bass 1" enumval=39 blockIdentity="midi.instrument"
    SynthBass1 = 39,
    //% block="Synth Bass 2" enumval=40 blockIdentity="midi.instrument"
    SynthBass2 = 40,
    //% block="Violin" enumval=41 blockIdentity="midi.instrument"
    Violin = 41,
    //% block="Viola" enumval=42 blockIdentity="midi.instrument"
    Viola = 42,
    //% block="Cello" enumval=43 blockIdentity="midi.instrument"
    Cello = 43,
    //% block="Contrabass" enumval=44 blockIdentity="midi.instrument"
    Contrabass = 44,
    //% block="Tremolo Strings" enumval=45 blockIdentity="midi.instrument"
    TremoloStrings = 45,
    //% block="Pizzicato Strings" enumval=46 blockIdentity="midi.instrument"
    PizzicatoStrings = 46,
    //% block="Orchestral Harp" enumval=47 blockIdentity="midi.instrument"
    OrchestralHarp = 47,
    //% block="Timpani" enumval=48 blockIdentity="midi.instrument"
    Timpani = 48,
    //% block="String Ensemble 1" enumval=49 blockIdentity="midi.instrument"
    StringEnsemble1 = 49,
    //% block="String Ensemble 2" enumval=50 blockIdentity="midi.instrument"
    StringEnsemble2 = 50,
    //% block="SynthStrings 1" enumval=51 blockIdentity="midi.instrument"
    SynthStrings1 = 51,
    //% block="SynthStrings 2" enumval=52 blockIdentity="midi.instrument"
    SynthStrings2 = 52,
    //% block="Choir Aahs" enumval=53 blockIdentity="midi.instrument"
    ChoirAahs = 53,
    //% block="Voice Oohs" enumval=54 blockIdentity="midi.instrument"
    VoiceOohs = 54,
    //% block="Synth Voice" enumval=55 blockIdentity="midi.instrument"
    SynthVoice = 55,
    //% block="Orchestra Hit" enumval=56 blockIdentity="midi.instrument"
    OrchestraHit = 56,
    //% block="Trumpet" enumval=57 blockIdentity="midi.instrument"
    Trumpet = 57,
    //% block="Trombone" enumval=58 blockIdentity="midi.instrument"
    Trombone = 58,
    //% block="Tuba" enumval=59 blockIdentity="midi.instrument"
    Tuba = 59,
    //% block="Muted Trumpet" enumval=60 blockIdentity="midi.instrument"
    MutedTrumpet = 60,
    //% block="French Horn" enumval=61 blockIdentity="midi.instrument"
    FrenchHorn = 61,
    //% block="Brass Section" enumval=62 blockIdentity="midi.instrument"
    BrassSection = 62,
    //% block="SynthBrass 1" enumval=63 blockIdentity="midi.instrument"
    SynthBrass1 = 63,
    //% block="SynthBrass 2" enumval=64 blockIdentity="midi.instrument"
    SynthBrass2 = 64,
    //% block="Soprano Sax" enumval=65 blockIdentity="midi.instrument"
    SopranoSax = 65,
    //% block="Alto Sax" enumval=66 blockIdentity="midi.instrument"
    AltoSax = 66,
    //% block="Tenor Sax" enumval=67 blockIdentity="midi.instrument"
    TenorSax = 67,
    //% block="Baritone Sax" enumval=68 blockIdentity="midi.instrument"
    BaritoneSax = 68,
    //% block="Oboe" enumval=69 blockIdentity="midi.instrument"
    Oboe = 69,
    //% block="English Horn" enumval=70 blockIdentity="midi.instrument"
    EnglishHorn = 70,
    //% block="Bassoon" enumval=71 blockIdentity="midi.instrument"
    Bassoon = 71,
    //% block="Clarinet" enumval=72 blockIdentity="midi.instrument"
    Clarinet = 72,
    //% block="Piccolo" enumval=73 blockIdentity="midi.instrument"
    Piccolo = 73,
    //% block="Flute" enumval=74 blockIdentity="midi.instrument"
    Flute = 74,
    //% block="Recorder" enumval=75 blockIdentity="midi.instrument"
    Recorder = 75,
    //% block="Pan Flute" enumval=76 blockIdentity="midi.instrument"
    PanFlute = 76,
    //% block="Blown Bottle" enumval=77 blockIdentity="midi.instrument"
    BlownBottle = 77,
    //% block="Shakuhachi" enumval=78 blockIdentity="midi.instrument"
    Shakuhachi = 78,
    //% block="Whistle" enumval=79 blockIdentity="midi.instrument"
    Whistle = 79,
    //% block="Ocarina" enumval=80 blockIdentity="midi.instrument"
    Ocarina = 80,
    //% block="Lead 1 (square)" enumval=81 blockIdentity="midi.instrument"
    LeadSquare = 81,
    //% block="Lead 2 (sawtooth)" enumval=82 blockIdentity="midi.instrument"
    LeadSawtooth = 82,
    //% block="Lead 3 (calliope)" enumval=83 blockIdentity="midi.instrument"
    LeadCalliope = 83,
    //% block="Lead 4 (chiff)" enumval=84 blockIdentity="midi.instrument"
    LeadChiff = 84,
    //% block="Lead 5 (charang)" enumval=85 blockIdentity="midi.instrument"
    LeadCharang = 85,
    //% block="Lead 6 (voice)" enumval=86 blockIdentity="midi.instrument"
    LeadVoice = 86,
    //% block="Lead 7 (fifths)" enumval=87 blockIdentity="midi.instrument"
    LeadFifths = 87,
    //% block="Lead 8 (bass + lead)" enumval=88 blockIdentity="midi.instrument"
    LeadBassLead = 88,
    //% block="Pad 1 (new age)" enumval=89 blockIdentity="midi.instrument"
    PadNewAge = 89,
    //% block="Pad 2 (warm)" enumval=90 blockIdentity="midi.instrument"
    PadWarm = 90,
    //% block="Pad 3 (polysynth)" enumval=91 blockIdentity="midi.instrument"
    PadPolysynth = 91,
    //% block="Pad 4 (choir)" enumval=92 blockIdentity="midi.instrument"
    PadChoir = 92,
    //% block="Pad 5 (bowed)" enumval=93 blockIdentity="midi.instrument"
    PadBowed = 93,
    //% block="Pad 6 (metallic)" enumval=94 blockIdentity="midi.instrument"
    PadMetallic = 94,
    //% block="Pad 7 (halo)" enumval=95 blockIdentity="midi.instrument"
    PadHalo = 95,
    //% block="Pad 8 (sweep)" enumval=96 blockIdentity="midi.instrument"
    PadWweep = 96,
    //% block="FX 1 (rain)" enumval=97 blockIdentity="midi.instrument"
    FXRain = 97,
    //% block="FX 2 (soundtrack)" enumval=98 blockIdentity="midi.instrument"
    FXSoundtrack = 98,
    //% block="FX 3 (crystal)" enumval=99 blockIdentity="midi.instrument"
    FXCrystal = 99,
    //% block="FX 4 (atmosphere)" enumval=100 blockIdentity="midi.instrument"
    FXAtmosphere = 100,
    //% block="FX 5 (brightness)" enumval=101 blockIdentity="midi.instrument"
    FXBrightness = 101,
    //% block="FX 6 (goblins)" enumval=102 blockIdentity="midi.instrument"
    FXGoblins = 102,
    //% block="FX 7 (echoes)" enumval=103 blockIdentity="midi.instrument"
    FXEchoes = 103,
    //% block="FX 8 (sci-fi)" enumval=104 blockIdentity="midi.instrument"
    FXSciFi = 104,
    //% block="Sitar" enumval=105 blockIdentity="midi.instrument"
    Sitar = 105,
    //% block="Banjo" enumval=106 blockIdentity="midi.instrument"
    Banjo = 106,
    //% block="Shamisen" enumval=107 blockIdentity="midi.instrument"
    Shamisen = 107,
    //% block="Koto" enumval=108 blockIdentity="midi.instrument"
    Koto = 108,
    //% block="Kalimba" enumval=109 blockIdentity="midi.instrument"
    Kalimba = 109,
    //% block="Bag pipe" enumval=110 blockIdentity="midi.instrument"
    Bagpipe = 110,
    //% block="Fiddle" enumval=111 blockIdentity="midi.instrument"
    Fiddle = 111,
    //% block="Shanai" enumval=112 blockIdentity="midi.instrument"
    Shanai = 112,
    //% block="Tinkle Bell" enumval=113 blockIdentity="midi.instrument"
    TinkleBell = 113,
    //% block="Agogo" enumval=114 blockIdentity="midi.instrument"
    Agogo = 114,
    //% block="Steel Drums" enumval=115 blockIdentity="midi.instrument"
    SteelDrums = 115,
    //% block="Woodblock" enumval=116 blockIdentity="midi.instrument"
    Woodblock = 116,
    //% block="Taiko Drum" enumval=117 blockIdentity="midi.instrument"
    TaikoDrum = 117,
    //% block="Melodic Tom" enumval=118 blockIdentity="midi.instrument"
    MelodicTom = 118,
    //% block="Synth Drum" enumval=119 blockIdentity="midi.instrument"
    SynthDrum = 119,
    //% block="Reverse Cymbal" enumval=120 blockIdentity="midi.instrument"
    ReverseCymbal = 120,
    //% block="Guitar Fret Noise" enumval=121 blockIdentity="midi.instrument"
    GuitarFretNoise = 121,
    //% block="Breath Noise" enumval=122 blockIdentity="midi.instrument"
    BreathNoise = 122,
    //% block="Seashore" enumval=123 blockIdentity="midi.instrument"
    Seashore = 123,
    //% block="Bird Tweet" enumval=124 blockIdentity="midi.instrument"
    BirdTweet = 124,
    //% block="Telephone Ring" enumval=125 blockIdentity="midi.instrument"
    TelephoneRing = 125,
    //% block="Helicopter" enumval=126 blockIdentity="midi.instrument"
    Helicopter = 126,
    //% block="Applause" enumval=127 blockIdentity="midi.instrument"
    Applause = 127,
    //% block="Gunshot" enumval=128 blockIdentity="midi.instrument"
    Gunshot = 128
}

enum DrumSound {
    //% block="Acoustic Bass Drum" enumval=35 blockIdentity="midi.drum"
    AcousticBassDrum = 35,
    //% block="Bass Drum 1" enumval=36 blockIdentity="midi.drum"
    BassDrum1 = 36,
    //% block="Side Stick" enumval=37 blockIdentity="midi.drum"
    SideStick = 37,
    //% block="Acoustic Snare" enumval=38 blockIdentity="midi.drum"
    AcousticSnare = 38,
    //% block="Hand Clap" enumval=39 blockIdentity="midi.drum"
    HandClap = 39,
    //% block="Electric Snare" enumval=40 blockIdentity="midi.drum"
    ElectricSnare = 40,
    //% block="Low Floor Tom" enumval=41 blockIdentity="midi.drum"
    LowFloorTom = 41,
    //% block="Closed Hi Hat" enumval=42 blockIdentity="midi.drum"
    ClosedHiHat = 42,
    //% block"High Floor Tom" enumval=43 blockIdentity="midi.drum"
    HighFloorTom = 43,
    //% block="Pedal Hi-Hat" enumval=44 blockIdentity="midi.drum"
    PedalHiHat = 44,
    //% block="Low Tom" enumval=45 blockIdentity="midi.drum"
    LowTom = 45,
    //% block="Open Hi-Hat" enumval=46 blockIdentity="midi.drum"
    OpenHiHat = 46,
    //% block="Low-Mid Tom" enumval=47 blockIdentity="midi.drum"
    LowMidTom = 47,
    //% block="Hi-Mid Tom" enumval=48 blockIdentity="midi.drum"
    HiMidTom = 48,
    //% block="Crash Cymbal 1" enumval=49 blockIdentity="midi.drum"
    CrashCymbal1 = 49,
    //% block="High Tom" enumval=50 blockIdentity="midi.drum"
    HighTom = 50,
    //% block="Ride Cymbal 1" enumval=51 blockIdentity="midi.drum"
    RideCymbal1 = 51,
    //% block="Chinese Cymbal" enumval=52 blockIdentity="midi.drum"
    ChineseCymbal = 52,
    //% block="Ride Bell" enumval=53 blockIdentity="midi.drum"
    RideBell = 53,
    //% block="Tambourine" enumval=54 blockIdentity="midi.drum"
    Tambourine = 54,
    //% block="Splash Cymbal" enumval=55 blockIdentity="midi.drum"
    SplashCymbal = 55,
    //% block="Cowbell" enumval=56 blockIdentity="midi.drum"
    Cowbell = 56,
    //% block="Crash Cymbal 2" enumval=57 blockIdentity="midi.drum"
    CrashCymbal2 = 57,
    //% block="Vibraslap" enumval=58 blockIdentity="midi.drum"
    Vibraslap = 58,
    //% block="Ride Cymbal 2" enumval=59 blockIdentity="midi.drum"
    RideCymbal2 = 59,
    //% block="Hi Bongo" enumval=60 blockIdentity="midi.drum"
    HiBongo = 60,
    //% block="Low Bongo" enumval=61 blockIdentity="midi.drum"
    LowBongo = 61,
    //% block="Mute Hi Conga" enumval=62 blockIdentity="midi.drum"
    MuteHiConga = 62,
    //% block="Open Hi Conga" enumval=63 blockIdentity="midi.drum"
    OpenHiConga = 63,
    //% block="Low Conga" enumval=64 blockIdentity="midi.drum"
    LowConga = 64,
    //% block="High Timbale" enumval=65 blockIdentity="midi.drum"
    HighTimbale = 65,
    //% block="Low Timbale" enumval=66 blockIdentity="midi.drum"
    LowTimbale = 66,
    //% block="High Agogo" enumval=67 blockIdentity="midi.drum"
    HighAgogo = 67,
    //% block="Low Agogo" enumval=68 blockIdentity="midi.drum"
    LowAgogo = 68,
    //% block="Cabasa" enumval=69 blockIdentity="midi.drum"
    Cabasa = 69,
    //% block="Maracas" enumval=70 blockIdentity="midi.drum"
    Maracas = 70,
    //% block="Short Whistle" enumval=71 blockIdentity="midi.drum"
    ShortWhistle = 71,
    //% block="Long Whistle" enumval=72 blockIdentity="midi.drum"
    LongWhistle = 72,
    //% block="Short Guiro" enumval=73 blockIdentity="midi.drum"
    ShortGuiro = 73,
    //% block="Long Guiro" enumval=74 blockIdentity="midi.drum"
    LongGuiro = 74,
    //% block="Claves" enumval=75 blockIdentity="midi.drum"
    Claves = 75,
    //% block="Hi Wood Block" enumval=76 blockIdentity="midi.drum"
    HiWoodBlock = 76,
    //% block="Low Wood Block" enumval=77 blockIdentity="midi.drum"
    LowWoodBlock = 77,
    //% block="Mute Cuica" enumval=78 blockIdentity="midi.drum"
    MuteCuica = 78,
    //% block="Open Cuica" enumval=79 blockIdentity="midi.drum"
    OpenCuica = 79,
    //% block="Mute Triangle" enumval=80 blockIdentity="midi.drum"
    MuteTriangle = 80,
    //% block="Open Triangle" enumval=81 blockIdentity="midi.drum"
    OpenTriangle = 81,
}

enum MidiCommand {
    //% block="tune request"
    TuneRequest = 0xf6,
    //% block="timing clock"
    TimingClock = 0xf8,
    //% block="start"
    Start = 0xfa,
    //% block="continue"
    Continue = 0xfb,
    //% block="stop"
    Stop = 0xfc,
    //% block="active sensing"
    ActiveSensing = 0xfe,
    //% block="reset"
    Reset = 0xff
}

namespace midi {
    /**
     * Transport needs to be set prior to using MIDI APIs
     */
    let inputTransport: IMidiInputTransport;

    /**
     * A medium that allows to send MIDI payloads
     */
    export interface IMidiInputTransport {
        send(data: uint8[]): void;
    }

    class SerialTransport implements IMidiInputTransport {
        send(data: uint8[]) {
            const buf = pins.createBuffer(data.length);
            for (let i = 0; i < data.length; ++i)
                buf[i] = data[i];
            serial.writeBuffer(buf);
        }
    }

    /**
     * Sets the transport mechanism to send MIDI commands
     * @param transport current transport
     */
    //% blockId=midi_set_input_transport block="set input transport %transport"
    //% advanced=true
    export function setInputTransport(transport: IMidiInputTransport) {
        if (!transport) return;

        inputTransport = transport;
    }

    /**
     * Creates a serial transport
     */
    //% blockId=midi_serial_transport block="serial transport"
    //% advanced=true
    export function serialTransport(): IMidiInputTransport {
        return new SerialTransport();
    }

    /**
     * A Input MIDI device
     */
    //%
    export class MidiInput {
        channel: number;
        velocity: number;

        constructor(channel: number) {
            this.channel = channel;
            this.velocity = 0x7f;
        }

        /**
         * Sets the instrument on this input channel
         * @param instrument the instrument to select
         */
        //% blockId=midi_set_instrument block="%this|set instrument %instrument=midi_instrument"
        //% instrument.min=0 instrument.max=16
        setInstrument(instrument: uint8): void {
            if (!inputTransport) return;

            instrument -= 1;
            if (instrument < 0 || instrument > 0x7f) return;

            inputTransport.send([0xc0 | this.channel, instrument]);
        }

        /**
         * Sets the velocity
         * @param velocity velocity of the instrument
         */
        //% blockId=midi_set_velocity block="%this|set velocity %velocity"
        //% velocity.min=0 velocity.max=127
        setVelocity(velocity: uint8): void {
            this.velocity = velocity & 0x7F;
        }

        /**
         * Starts playing a note
         * @param note the note to play
         */
        //% blockId=midi_note_on block="%this|note on %note"
        //% velocity.min=0 velocity.max=127
        noteOn(note: uint8, velocity = 0): void {
            if (!inputTransport) return;
            if (note < 0 || note > 0x7F) return;

            inputTransport.send([0x90 | this.channel, note, velocity || this.velocity]);
        }

        /**
         * Stops playing a note
         * @param note the note to stop
         */
        //% blockId=midi_note_off block="%this|note off %note"
        //% velocity.min=0 velocity.max=127
        noteOff(note: uint8, velocity = 0): void {
            if (!inputTransport) return;
            if (note < 0 || note > 0x7F) return;

            inputTransport.send([0x80 | this.channel, note, velocity || this.velocity]);
        }

        /**
         * Plays a note for the given duration and adds a small pause
         * @param note note to play
         * @param duration duration of play
         */
        //% blockId=midi_note block="%this|note %note|duration %duration=device_beat"
        note(note: uint8, duration: number): void {
            if (duration > 0) {
                this.noteOn(note);
                basic.pause(duration);
            }
            this.noteOff(note);
            basic.pause(6);
        }

        /**
         * Sets the pitch on the channel
         * @param amount current bend, eg: 8192
         */
        //% amount.min=0 amount.max=16383
        setPitchBend(amount: uint16) {
            if (!inputTransport) return;

            amount = amount & 0x3fff;
            inputTransport.send([0xe0 | this.channel, amount & 0x7f, (amount >> 7) & 0x7f]);
        }

        /**
         * Sends a MIDI command
         * @param cmd the command to send
         */
        //% blockId=midi_command block="command %cmd"
        command(cmd: MidiCommand) {
            if (!inputTransport) return;

            inputTransport.send([cmd | this.channel]);
        }
    }

    /**
     * Selects an instrument type
     * @param instrument the instrument type
     */
    //% blockId=midi_instrument block="%instrument"
    //% shim=TD_ID weight=5
    export function instrument(instrument: MidiInstrument): number {
        return instrument;
    }

    /**
     * Selects a drum sound
     * @param drumSound the type of sound
     */
    //% blockId=midi_drum_sound block="%sound"
    //% shim=TD_ID weight=5
    export function drumSound(sound: DrumSound): number {
        return sound;
    }

    let drumInput: MidiInput;
    /**
     * Plays a drum sound on channel 10
     * @param key index of the sound
     */
    //% blockId=midi_drum block="drum %key=midi_drum_sound"
    export function drum(key: number): void {
        if (!drumInput) drumInput = input(10);
        drumInput.noteOn(key);
    }

    /**
     * Creates a MIDI input device. If not setup, uses serial transport.
     * @param channel the selected input channel, eg: 0
     */
    //% blockId="midi_input" block="input %channel"
    export function input(channel: number): MidiInput {
        if (!inputTransport)
            inputTransport = new SerialTransport();

        channel = Math.max(0, Math.min(15, channel));
        return new MidiInput(channel);
    }
}